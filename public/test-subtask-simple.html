<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Subtareas Simple</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; }
        input, textarea { width: 100%; padding: 5px; }
        button { padding: 10px 20px; margin: 5px; }
        #result { background: #f0f0f0; padding: 10px; margin: 20px 0; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Test Subtareas Simple</h1>
    
    <form id="testForm">
        <div class="form-group">
            <label>TÃ­tulo de la tarea:</label>
            <input type="text" name="task_title" value="Tarea de prueba" required>
        </div>
        
        <div class="form-group">
            <label>Fecha lÃ­mite:</label>
            <input type="date" name="task_due_date" value="2024-12-31" required>
        </div>
        
        <div class="form-group">
            <label>Proyecto:</label>
            <input type="text" name="task_project" value="29">
        </div>
        
        <div class="form-group">
            <label>DescripciÃ³n:</label>
            <textarea name="task_description">DescripciÃ³n de prueba</textarea>
        </div>
        
        <div class="form-group">
            <label>Miembros asignados:</label>
            <input type="text" name="assigned_members[]" value="1">
            <input type="text" name="assigned_members[]" value="2">
        </div>
        
        <div class="form-group">
            <label>Prioridad:</label>
            <input type="text" name="priority" value="medium">
        </div>
        
        <div class="form-group">
            <label>Subtareas (JSON):</label>
            <textarea name="subtasks" rows="5">[{"title":"Subtarea 1","percentage":"25","description":"DescripciÃ³n 1"},{"title":"Subtarea 2","percentage":"50","description":"DescripciÃ³n 2"}]</textarea>
        </div>
        
        <button type="button" onclick="testSubmit()">ğŸ§ª Probar EnvÃ­o</button>
        <button type="button" onclick="testController()">ğŸ“¡ Probar Controlador</button>
        <button type="button" onclick="testInsert()">ğŸ’¾ Probar InserciÃ³n</button>
    </form>
    
    <div id="result">
        <strong>Resultado:</strong>
        <br>Haz clic en uno de los botones para probar
    </div>
    
    <script>
        function testSubmit() {
            const form = document.getElementById('testForm');
            const formData = new FormData(form);
            
            console.log('ğŸ“‹ === FORM DATA ===');
            for (let [key, value] of formData.entries()) {
                console.log(`${key}:`, value);
            }
            
            // Verificar especÃ­ficamente las subtareas
            const subtasksValue = formData.get('subtasks');
            console.log('ğŸ” Valor de subtareas:', subtasksValue);
            
            try {
                const parsed = JSON.parse(subtasksValue);
                console.log('âœ… Subtareas parseadas:', parsed);
                console.log('âœ… Cantidad de subtareas:', parsed.length);
            } catch (e) {
                console.error('âŒ Error parseando subtareas:', e);
            }
            
            // Mostrar resultado
            document.getElementById('result').innerHTML = `
                <strong>FormData creado:</strong>
                <br>Subtareas: ${subtasksValue}
                <br>Subtareas parseadas: ${JSON.stringify(JSON.parse(subtasksValue), null, 2)}
            `;
        }
        
        function testController() {
            const form = document.getElementById('testForm');
            const formData = new FormData(form);
            
            console.log('ğŸ“¡ === ENVIANDO AL CONTROLADOR ===');
            
            fetch('?route=test-controller', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                console.log('ğŸ“¡ Response status:', response.status);
                return response.text();
            })
            .then(text => {
                console.log('ğŸ“„ Response body:', text);
                
                try {
                    const data = JSON.parse(text);
                    console.log('âœ… JSON parseado:', data);
                    
                    document.getElementById('result').innerHTML = `
                        <strong>Respuesta del controlador:</strong>
                        <br>${JSON.stringify(data, null, 2)}
                    `;
                } catch (e) {
                    console.error('âŒ Error parseando JSON:', e);
                    document.getElementById('result').innerHTML = `
                        <strong>Error parseando JSON:</strong>
                        <br>${text}
                    `;
                }
            })
            .catch(error => {
                console.error('ğŸ’¥ Error:', error);
                document.getElementById('result').innerHTML = `
                    <strong>Error de red:</strong>
                    <br>${error.message}
                `;
            });
        }
        
        function testInsert() {
            const form = document.getElementById('testForm');
            const formData = new FormData(form);
            
            console.log('ğŸ’¾ === PROBANDO INSERCIÃ“N ===');
            
            fetch('?route=test-subtask-insert', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                console.log('ğŸ“¡ Response status:', response.status);
                return response.text();
            })
            .then(text => {
                console.log('ğŸ“„ Response body:', text);
                
                try {
                    const data = JSON.parse(text);
                    console.log('âœ… JSON parseado:', data);
                    
                    document.getElementById('result').innerHTML = `
                        <strong>Resultado de inserciÃ³n:</strong>
                        <br>${JSON.stringify(data, null, 2)}
                    `;
                } catch (e) {
                    console.error('âŒ Error parseando JSON:', e);
                    document.getElementById('result').innerHTML = `
                        <strong>Error parseando JSON:</strong>
                        <br>${text}
                    `;
                }
            })
            .catch(error => {
                console.error('ğŸ’¥ Error:', error);
                document.getElementById('result').innerHTML = `
                    <strong>Error de red:</strong>
                    <br>${error.message}
                `;
            });
        }
        
        // InicializaciÃ³n
        console.log('ğŸš€ Test de subtareas cargado');
        console.log('ğŸ“‹ Formulario disponible:', document.getElementById('testForm'));
    </script>
</body>
</html>
